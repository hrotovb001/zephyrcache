services:
  etcd:
    image: quay.io/coreos/etcd:v3.5.15
    command: >
      /usr/local/bin/etcd
      --name etcd0
      --advertise-client-urls http://0.0.0.0:2379
      --listen-client-urls http://0.0.0.0:2379
      --initial-advertise-peer-urls http://0.0.0.0:2380
      --listen-peer-urls http://0.0.0.0:2380
      --initial-cluster etcd0=http://0.0.0.0:2380
      --initial-cluster-state new
    ports:
      - "2379:2379"

  node1:
    build:
      context: ..
      dockerfile: Dockerfile   # adjust if your filename differs
    environment:
      - ETCD_ENDPOINTS=http://etcd:2379
      - CLUSTER=dev
      - SELF_ID=node1
      - SELF_ADDR=http://node1:8080
    depends_on: [etcd]
    ports: ["8080:8080"]

  node2:
    build:
      context: ..
      dockerfile: Dockerfile
    environment:
      - ETCD_ENDPOINTS=http://etcd:2379
      - CLUSTER=dev
      - SELF_ID=node2
      - SELF_ADDR=http://node2:8080
    depends_on: [etcd]
    ports: ["8081:8080"]

  node3:
    build:
      context: ..
      dockerfile: Dockerfile
    environment:
      - ETCD_ENDPOINTS=http://etcd:2379
      - CLUSTER=dev
      - SELF_ID=node3
      - SELF_ADDR=http://node3:8080
    depends_on: [etcd]
    ports: ["8082:8080"]
